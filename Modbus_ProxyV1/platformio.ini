
[env:esp32-s3-base]
; Common settings for both OTA and Serial environments
platform = espressif32
board = lolin_s3_mini
framework = arduino
monitor_speed = 115200
monitor_dtr = 0
monitor_rts = 0
build_flags =
    -DARDUINO_USB_CDC_ON_BOOT=1
    -std=gnu++17
board_build.usb_cdc = true
lib_deps =
    bblanchon/ArduinoJson@^6.19.4
    knolleary/PubSubClient@^2.8
    ArduinoOTA
    adafruit/Adafruit NeoPixel@^1.10.0

; ----------------------------------------------------------------------
; --- ENVIRONMENT 1: SERIAL Upload/Monitor (for initial flash) ---
[env:esp32-s3-serial]
extends = env:esp32-s3-base
; Use the default serial protocol
upload_protocol = esptool
upload_port = COM6
monitor_port = COM6

; ----------------------------------------------------------------------
; --- ENVIRONMENT 2: OTA Upload (for wireless updates) ---
[env:esp32-s3-ota]
extends = env:esp32-s3-base
; Use the network protocol
upload_protocol = espota
upload_port = 192.168.0.177
upload_flags = --auth=modbus_ota_2023
; Monitor port remains COM6 (inherited) for viewing serial logs wirelessly